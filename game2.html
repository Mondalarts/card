<script>
  const board = document.getElementById("board");
  const status = document.getElementById("status");
  const timerEl = document.getElementById("timer");
  let cells = [];
  let currentPlayer = "X";
  let botPlayer = "O";
  let round = 1;
  let wins = 0;
  let interval;
  let timeLeft = 15;

  const combos = [
    [0, 1, 2],[3, 4, 5],[6, 7, 8],
    [0, 3, 6],[1, 4, 7],[2, 5, 8],
    [0, 4, 8],[2, 4, 6]
  ];

  function createBoard() {
    board.innerHTML = "";
    cells = [];
    for (let i = 0; i < 9; i++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.dataset.index = i;
      cell.addEventListener("click", handleClick);
      board.appendChild(cell);
      cells.push(cell);
    }
    startTimer();
  }

  function handleClick(e) {
    const cell = e.target;
    if (cell.textContent !== "") return;
    cell.textContent = currentPlayer;
    cell.classList.add(currentPlayer === "X" ? "red" : "blue");

    if (checkWinner(currentPlayer)) {
      wins++;
      status.textContent = `âœ… You won Round ${round}!`;
      clearInterval(interval);
      setTimeout(() => {
        if (wins === 2) {
          const iq = Math.floor(Math.random() * 40) + 120; // 120â€“160
          alert(`ðŸŽ‰ You won 2 rounds! Your IQ is ${iq} ðŸ¤¯`);
          window.location.href = "game3.html";
        } else {
          round++;
          resetRound();
        }
      }, 1000);
      return;
    }

    if (isDraw()) {
      status.textContent = "ðŸ¤ Draw!";
      clearInterval(interval);
      setTimeout(() => {
        round++;
        resetRound();
      }, 1000);
      return;
    }

    botMove();
  }

  function botMove() {
    // 1ï¸âƒ£ Try to win
    for (let combo of combos) {
      const [a,b,c] = combo;
      const line = [cells[a],cells[b],cells[c]];
      if (line.filter(c => c.textContent === botPlayer).length === 2 &&
          line.filter(c => c.textContent === "").length === 1) {
        makeBotMove(line.find(c => c.textContent === ""));
        return;
      }
    }
    // 2ï¸âƒ£ Block player
    for (let combo of combos) {
      const [a,b,c] = combo;
      const line = [cells[a],cells[b],cells[c]];
      if (line.filter(c => c.textContent === currentPlayer).length === 2 &&
          line.filter(c => c.textContent === "").length === 1) {
        makeBotMove(line.find(c => c.textContent === ""));
        return;
      }
    }
    // 3ï¸âƒ£ Center
    if (cells[4].textContent === "") { makeBotMove(cells[4]); return; }
    // 4ï¸âƒ£ Corner
    const corners = [0,2,6,8].filter(i => cells[i].textContent === "");
    if (corners.length > 0) {
      makeBotMove(cells[corners[Math.floor(Math.random()*corners.length)]]);
      return;
    }
    // 5ï¸âƒ£ Random
    let emptyCells = cells.filter(c => c.textContent === "");
    if (emptyCells.length > 0) {
      makeBotMove(emptyCells[Math.floor(Math.random()*emptyCells.length)]);
    }
  }

  function makeBotMove(cell) {
    cell.textContent = botPlayer;
    cell.classList.add(botPlayer === "X" ? "red" : "blue");

    if (checkWinner(botPlayer)) {
      status.textContent = `ðŸ’€ Bot won Round ${round}`;
      clearInterval(interval);
      setTimeout(() => { round++; resetRound(); }, 1000);
    } else if (isDraw()) {
      status.textContent = "ðŸ¤ Draw!";
      clearInterval(interval);
      setTimeout(() => { round++; resetRound(); }, 1000);
    }
  }

  function isDraw() {
    return cells.every(c => c.textContent !== "");
  }

  function checkWinner(player) {
    return combos.some(combo => combo.every(i => cells[i].textContent === player));
  }

  function resetRound() {
    status.textContent = `Round ${round}: Your turn`;
    timeLeft = 15;
    createBoard();
  }

  function startTimer() {
    clearInterval(interval);
    interval = setInterval(() => {
      timeLeft--;
      timerEl.textContent = `Time left: ${timeLeft}`;
      if (timeLeft <= 0) {
        clearInterval(interval);
        status.textContent = "â° Time's up! You lost this round.";
        round++;
        setTimeout(resetRound, 1000);
      }
    }, 1000);
  }

  createBoard();
</script>
